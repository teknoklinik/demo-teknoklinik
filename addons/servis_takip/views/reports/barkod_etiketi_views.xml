<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="paperformat_servis_etiket_10x8" model="report.paperformat">
            <field name="name">Servis Etiketi 10x8cm</field>
            <field name="format">custom</field>
            <field name="page_height">80</field>
            <field name="page_width">100</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">0</field>
            <field name="margin_bottom">0</field>
            <field name="margin_left">0</field>
            <field name="margin_right">0</field>
            <field name="dpi">96</field>
        </record>

        <record id="action_report_barkod_etiketi" model="ir.actions.report">
            <field name="name">Barkod Etiketi</field>
            <field name="model">servis.kaydi</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">servis_takip.report_barkod_etiketi</field>
            <field name="print_report_name">'Barkod_%s' % (object.seri_no or object.name)</field>
            <field name="paperformat_id" ref="paperformat_servis_etiket_10x8"/>
        </record>

        <template id="report_barkod_etiketi">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="doc">
                    <div class="page" style="width: 100mm; min-height: 80mm; position: relative; font-family: 'DejaVu Sans', sans-serif; color: black; background: white; margin: 0; padding: 0;">
                        
                        <style>
                            .label-container { width: 100mm; min-height: 80mm; padding: 3mm; box-sizing: border-box; }
                            .header-title { font-size: 22px; font-weight: bold; text-align: center; border-bottom: 2px solid black; padding-bottom: 2mm; margin-bottom: 3mm; text-transform: uppercase; }
                            .info-table { width: 100%; border-collapse: collapse; }
                            .info-td-left { width: 62%; vertical-align: top; border-right: 1px solid black; padding-right: 2mm; }
                            .info-td-right { width: 38%; vertical-align: top; text-align: center; padding-left: 2mm; }
                            .bold-label { font-size: 13px; font-weight: bold; }
                            .value-text { font-size: 13px; }
                            .barcode-img { width: 55mm; height: 15mm; display: block; margin-top: 1mm; }
                            .warranty-box { background: black; color: white; padding: 2mm; font-weight: bold; font-size: 16px; margin-top: 5mm; display: inline-block; width: 90%; }
                            
                            /* DÜZELTİLEN KISIM: Yükseklik sınırı kaldırıldı, esneklik sağlandı */
                            .complaint-box { 
                                border-top: 2px solid black; 
                                margin-top: 4mm; 
                                padding-top: 2mm; 
                                width: 100%;
                            }
                            .complaint-text {
                                font-size: 11px; 
                                line-height: 1.3;
                                word-wrap: break-word;
                            }
                        </style>

                        <div class="label-container">
                            <div class="header-title">
                                <t t-if="doc.musteri_id"><t t-esc="doc.musteri_id.name"/></t>
                            </div>

                            <table class="info-table">
                                <tr>
                                    <td class="info-td-left">
                                        <div style="margin-bottom: 1.5mm;">
                                            <span class="bold-label">Yetkilisi : </span>
                                            <span class="value-text"><t t-if="doc.musteri_id"><t t-esc="doc.musteri_id.name"/></t></span>
                                        </div>
                                        <div style="margin-bottom: 2mm;">
                                            <span class="bold-label">Telefon : </span>
                                            <span class="value-text"><t t-if="doc.musteri_id.phone"><t t-esc="doc.musteri_id.phone"/></t></span>
                                        </div>
                                        <div style="margin-top: 2mm;">
                                            <div class="bold-label">Seri No :</div>
                                            <div style="margin-top: 1mm;">
                                                <t t-set="barcode_data" t-value="doc.get_barcode_base64()"/>
                                                <t t-if="barcode_data">
                                                    <img t-att-src="'data:image/png;base64,%s' % barcode_data" class="barcode-img"/>
                                                </t>
                                                <div style="font-size: 16px; font-weight: bold; margin-top: 1mm;">
                                                    <t t-esc="doc.seri_no"/>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <td class="info-td-right">
                                        <div class="bold-label">Model :</div>
                                        <div style="font-size: 22px; font-weight: bold; margin-bottom: 2mm;">
                                            <t t-if="doc.urun_modeli_id"><t t-esc="doc.urun_modeli_id.name"/></t>
                                        </div>
                                        
                                        <div class="warranty-box">GARANTİLİ</div>
                                        
                                        <div style="font-size: 16px; font-weight: bold; margin-top: 3mm;">
                                            <t t-if="doc.kayit_tarihi"><t t-esc="doc.kayit_tarihi.strftime('%d.%m.%Y')"/></t>
                                        </div>
                                    </td>
                                </tr>
                            </table>

                            <div class="complaint-box">
                                <div style="font-weight: bold; font-size: 12px; text-align: center; margin-bottom: 2mm;">MÜŞTERİ ŞİKAYETLERİ</div>
                                <div class="complaint-text">
                                    <t t-if="doc.ariza_detay_ids">
                                        <t t-foreach="doc.ariza_detay_ids" t-as="ariza">
                                            • <t t-if="ariza.ariza_tanimi_id"><strong><t t-esc="ariza.ariza_tanimi_id.name"/>:</strong></t>
                                            <t t-esc="ariza.musteri_notu"/><br/>
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>